(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-new-food-flavor-setting"],{6103:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.tap-wrap[data-v-63d80400]{margin:4vw 0}.tap-item[data-v-63d80400]{border:1px solid #ddd;padding:2.7vw 8vw;margin-right:5.3vw}.tap-item.active[data-v-63d80400]{color:#fff;background-color:#3cba92}.list-item[data-v-63d80400]{margin:2.7vw 0}.checkbox-item[data-v-63d80400]{margin-left:2.7vw}.checkbox-item .checkbox[data-v-63d80400]{margin-left:.7vw}.btn-wrap[data-v-63d80400]{padding-top:5vw}.flavour-image[data-v-63d80400]{width:60px;height:60px;margin:0 2vw}.garnish-wrap[data-v-63d80400]{border:1px solid #ddd;padding:2vw;margin-bottom:2vw}.active-border[data-v-63d80400]{border:1px solid red}.garnish-picker-view[data-v-63d80400]{width:15vw}.garnish-choose-view[data-v-63d80400]{width:17vw}.garnish-item[data-v-63d80400]{width:25vw;margin-bottom:1vw}.shop-garnish-name[data-v-63d80400]{min-width:5vw;margin:1vw 3vw;text-align:center}.list-popup-header[data-v-63d80400]{margin-bottom:5vw}.list-popup-body[data-v-63d80400]{min-height:15vw;max-height:40vw;overflow-y:scroll}',""])},6761:function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"wrap"},[i("v-uni-view",[t._v("可选配菜和调味")]),i("v-uni-view",{staticClass:"tap-wrap flex"},t._l(t.tabList,function(e,n){return i("v-uni-view",{key:n,staticClass:"tap-item",class:t.tabIndex==n?"active":"",attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.changeTab.apply(void 0,arguments)}}},[i("v-uni-text",[t._v(t._s(e.name))])],1)}),1),0==t.tabIndex?i("v-uni-view",{staticClass:"lists-wrap"},t._l(t.lists,function(e,n){return i("v-uni-view",{key:n,staticClass:"flex flex-between list-item"},[i("v-uni-view",{staticClass:"flex flex-between"},[i("v-uni-image",{staticClass:"flavour-image",attrs:{src:e.image[0].url}}),i("v-uni-text",[t._v(t._s(e.name))])],1),i("v-uni-checkbox-group",{attrs:{"data-index":n},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeSelect.apply(void 0,arguments)}}},[t._l(e.select,function(n,a){return[i("v-uni-label",{key:a+"_0",staticClass:"checkbox-item"},[i("v-uni-checkbox",{staticClass:"checkbox",attrs:{value:a+"",checked:-1!=e.value.indexOf(a+"")}}),t._v(t._s(n.name))],1)]})],2)],1)}),1):i("v-uni-view",[i("v-uni-view",[i("v-uni-view",{staticClass:"btn btn-primary",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.createGarnish.apply(void 0,arguments)}}},[t._v("新建配菜分类")]),t._l(t.garnishList,function(e,n){return[e.isSave?i("v-uni-view",{staticClass:"flex flex-between garnish-wrap"},[i("v-uni-text",[t._v(t._s(e.categoryName))]),i("v-uni-text",{attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.editGarnish.apply(void 0,arguments)}}},[t._v("EDIT")])],1):i("v-uni-view",{key:n+"_0",staticClass:"garnish-wrap",class:t.errorIndex==n?"active-border":"",attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setActiveIndex.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"text-right"},[i("uni-icons",{attrs:{color:"#000",size:"30",type:"trash","data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteGarnish(n)}}})],1),i("v-uni-label",[t._v("配菜分类标题"),i("v-uni-view",{staticClass:"input-wrap"},[i("v-uni-input",{staticClass:"input",attrs:{type:"text",maxlength:"50",placeholder:"配菜分类标题"},model:{value:e.categoryName,callback:function(i){t.$set(e,"categoryName",i)},expression:"list.categoryName"}})],1)],1),i("v-uni-view",{staticClass:"flex flex-between"},[i("v-uni-label",[t._v("配菜可选数量"),i("uni-select",{staticClass:"garnish-picker-view",attrs:{list:t.numList,clearable:!1,showItemNum:5,style_Container:"font-size: 16px;",initValue:e.count,selectHideType:"hideAll"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeNumStatus.apply(void 0,arguments)}}})],1),i("v-uni-label",[t._v("配菜是否必选"),i("uni-select",{staticClass:"garnish-choose-view",attrs:{list:t.chooseNameList,clearable:!1,showItemNum:5,style_Container:"font-size: 16px;",initValue:e.isRequired?"必选":"非必选",selectHideType:"hideAll"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeRequireStatus.apply(void 0,arguments)}}})],1)],1),i("v-uni-text",{staticClass:"btn",attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseGarnish.apply(void 0,arguments)}}},[t._v("选择配菜")]),t._l(e.garnish,function(e,a){return["unavailable"!=e.status?i("v-uni-view",{key:a+"_0",staticClass:"flex flex-between align-center garnish-item"},[i("v-uni-text",{staticClass:"garnish-item-name"},[t._v("【"+t._s(e.name)+"】, 每份价格【$"+t._s(e.price)+"】")]),i("uni-icons",{attrs:{color:"#333",size:"20",type:"close-filled"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteShopGarnish(a,n)}}})],1):t._e()]}),i("v-uni-view",{staticClass:"text-right"},[i("v-uni-text",{staticClass:"btn",attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.saveGarnishForm.apply(void 0,arguments)}}},[t._v("save")])],1)],2)]})],2)],1),i("v-uni-view",{staticClass:"btn-wrap text-right"},[i("v-uni-text",{staticClass:"btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.cancel.apply(void 0,arguments)}}},[t._v("cancel")]),i("v-uni-text",{staticClass:"btn btn-primary",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.settingConfirm.apply(void 0,arguments)}}},[t._v("save")])],1),i("uni-popup",{ref:"listPopup",attrs:{type:"center",maskClick:!1}},[i("v-uni-view",{staticClass:"popup-wrap"},[i("v-uni-view",{staticClass:"flex flex-between list-popup-header"},[i("v-uni-text",[t._v("选择一项配菜")]),i("uni-icons",{attrs:{color:"#000",size:"25",type:"close"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closeListPopup.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"list-popup-body"},[i("v-uni-view",{staticClass:"flex flex-between"},t._l(t.popupNameList,function(e,n){return i("v-uni-text",{key:n,staticClass:"shop-garnish-name"},[t._v(t._s(e))])}),1),i("v-uni-view",{staticClass:"flex flex-between"},[t._l(t.shopGarnish,function(e,n){return[i("v-uni-text",{key:n+"_0",staticClass:"shop-garnish-name"},[t._v(t._s(e.name))]),i("v-uni-text",{key:n+"_1",staticClass:"shop-garnish-name"},[t._v(t._s(e.calorie))]),i("v-uni-text",{key:n+"_2",staticClass:"shop-garnish-name"},[t._v(t._s(e.count))]),i("v-uni-text",{key:n+"_3",staticClass:"btn shop-garnish-name",attrs:{"data-index":n},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectShopGarnish.apply(void 0,arguments)}}},[t._v("Select")])]})],2)],1)],1)],1),i("uni-popup",{ref:"setPopup",attrs:{type:"center"}},[i("v-uni-view",{staticClass:"popup-wrap"},[i("v-uni-view",{staticClass:"input-wrap"},[i("v-uni-input",{staticClass:"input",attrs:{type:"text",placeholder:"配菜价格（0为免费）"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.validatePrice.apply(void 0,arguments)}},model:{value:t.popupInputVal,callback:function(e){t.popupInputVal=e},expression:"popupInputVal"}})],1),i("v-uni-view",{staticClass:"text-center"},[i("v-uni-text",{staticClass:"btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chooseShopGarnish.apply(void 0,arguments)}}},[t._v("save")])],1)],1)],1),i("uni-notify",{ref:"notify"})],1)},s=[];i.d(e,"b",function(){return a}),i.d(e,"c",function(){return s}),i.d(e,"a",function(){return n})},7925:function(t,e,i){"use strict";var n=i("8890"),a=i.n(n);a.a},"7d24":function(t,e,i){"use strict";var n=i("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("a481");var a=n(i("75fc")),s=n(i("795b")),o=n(i("f499"));i("ac6a");var r=n(i("774e")),c=n(i("cebc")),u=n(i("dd6c")),l=n(i("ae08")),h=i("2f62"),p={components:{uniIcons:u.default,uniPopup:l.default},data:function(){return{foodId:"",tabList:[{name:"调味"},{name:"配菜"}],tabIndex:0,select:[{name:"多"},{name:"少"},{name:"标准"},{name:"无"}],lists:[],chooseNameList:["必选","非必选"],chooseList:[!0,!1],garnishList:[],shopGarnish:[],popupNameList:["name","caroline","库存","action"],activeIndex:-1,selectIndex:0,errorIndex:-1,hasNoComplete:!1,popupInputVal:""}},computed:(0,c.default)({},(0,h.mapState)(["flavorSetting"]),{numList:function(){return(0,r.default)(new Array(10).keys(),function(t){return t+""})}}),watch:{garnishList:{deep:!0,handler:function(t){this.errorIndex=-1,this.hasNoComplete=!1}}},onLoad:function(t){var e=this;this.foodId=t.foodId;var i=JSON.parse((0,o.default)(this.flavorSetting));this.getFlavorList().then(function(t){i.length&&i.map(function(t,i){e.lists=e.lists.map(function(e){return e.id==t.flavorId&&(e.value=t.value.map(function(t){return t=""+t,t})),e})})}),this.getFoodGarnishList(),this.setGarnishSetting([])},methods:(0,c.default)({},(0,h.mapMutations)(["setFlavorSetting","setGarnishSetting"]),{changeTab:function(t){var e=t.currentTarget.dataset.index;this.tabIndex=e},getFlavorList:function(){var t=this;return new s.default(function(e){t.$getHttp(t.$API.getFlavorList,{}).then(function(i){1==i.status&&(t.lists=i.data.map(function(e){return e.select=t.select,e})),e()})})},changeSelect:function(t){var e=t.detail,i=t.currentTarget;this.lists[i.dataset.index].value=e.value},settingConfirm:function(){var t=(0,a.default)(this.lists);if(this.saveGarnishSetting()){t=t.map(function(t){return t.flavorId=t.id,delete t.id,delete t.select,t}),this.setFlavorSetting(t),this.$notify({type:"success",title:"设置已保存"});var e=setTimeout(function(){clearTimeout(e),uni.navigateBack({delta:1})},2e3)}},getFoodGarnishList:function(){var t=this;this.$getHttp(this.$API.getFoodGarnishCategory,{foodId:this.foodId}).then(function(e){1==e.status&&(t.garnishList=e.data.map(function(t){return t.isSave=!0,t.garnish=t.garnish.map(function(t){return t.status=t.status?t.status:"",t}),t}))})},setActiveIndex:function(t){this.activeIndex=t.currentTarget.dataset.index},getShopGarnish:function(){var t=this;this.$getHttp(this.$API.getShopGarnish).then(function(e){1==e.status&&(t.shopGarnish=e.data.map(function(t){return t}))})},createGarnish:function(){var t=!1;this.garnishList.map(function(e,i){e.isSave||(t=!0)}),t?this.$notify({type:"warning",timeout:3e3,title:"请保存当前配菜"}):this.garnishList=[].concat((0,a.default)(this.garnishList),[{categoryName:"",count:1,isRequired:!1,isSave:!1,garnish:[]}])},openListPopup:function(){this.$refs.listPopup.open()},closeListPopup:function(){this.$refs.listPopup.close()},openSetPopup:function(){this.$refs.setPopup.open()},closeSetPopup:function(){this.$refs.setPopup.close()},chooseGarnish:function(t){this.getShopGarnish(),this.openListPopup()},editGarnish:function(t){var e=t.currentTarget.dataset.index;this.garnishList[e].isSave=!1},selectShopGarnish:function(t){this.openSetPopup(),this.selectIndex=t.currentTarget.dataset.index},chooseShopGarnish:function(t){var e=(0,a.default)(this.garnishList),i=this.shopGarnish[this.selectIndex];this.popupInputVal?(i.price=this.popupInputVal,e[this.activeIndex].garnish=[].concat((0,a.default)(e[this.activeIndex].garnish),[{name:i.name,price:i.price,garnishId:i.id}]),this.popupInputVal="",this.closeListPopup(),this.closeSetPopup()):this.$notify({type:"warning",timeout:3e3,title:"请设置配菜价格"})},deleteShopGarnish:function(t,e){this.garnishList[e].garnish[t].garnishId?this.garnishList[e].garnish[t].status="unavailable":this.garnishList[e].garnish.splice(t,1)},validatePrice:function(t){this.$nextTick(function(){this.popupInputVal=t.detail.value.replace(/[^(\-?\d+\.?\d+)]/g,"")})},changeNumStatus:function(t){this.garnishList[this.activeIndex].count=t.newVal},changeRequireStatus:function(t){this.garnishList[this.activeIndex].isRequired=this.chooseList[t.index]},saveGarnishForm:function(t){var e=this,i=t.currentTarget.dataset.index,n=this.garnishList[i];if(n.categoryName)n.garnish.length?n.id?this.$postHttp(this.$API.updateFoodGarnishCategory,{categoryId:n.id,data:{garnish:n.garnish,categoryName:n.categoryName,count:n.count,isRequired:n.isRequired},dataType:"json"}).then(function(t){1==t.status&&(e.garnishList[i].isSave=!0)}):this.garnishList[i].isSave=!0:this.$notify({type:"warning",timeout:3e3,title:"配菜项目必须填写"});else this.$notify({type:"warning",timeout:3e3,title:"分类标题必须填写"})},saveGarnishSetting:function(){var t=this,e=(0,a.default)(this.garnishList),i=[];return this.garnishList.map(function(e,i){e.isSave||(t.hasNoComplete=!0,t.errorIndex=i)}),this.hasNoComplete?(this.$notify({type:"warning",timeout:3e3,title:"请完成所有配菜设置后保存"}),!1):(e.map(function(t){t.id||i.push({garnish:t.garnish,categoryName:t.categoryName,count:t.count,isRequired:t.isRequired})}),this.setGarnishSetting(i),!0)},deleteGarnish:function(t){var e=this;this.garnishList[t].id?this.$getHttp(this.$API.deleteFoodGarnishCategory,{id:this.garnishList[t].id}).then(function(i){1==i.status&&e.garnishList.splice(t,1)}):this.garnishList.splice(t,1)},cancel:function(){uni.navigateBack({delta:1})}})};e.default=p},8890:function(t,e,i){var n=i("6103");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("4f06").default;a("6dee4ce4",n,!0,{sourceMap:!1,shadowMode:!1})},ad35:function(t,e,i){"use strict";i.r(e);var n=i("6761"),a=i("d793");for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);i("7925");var o,r=i("f0c5"),c=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"63d80400",null,!1,n["a"],o);e["default"]=c.exports},d793:function(t,e,i){"use strict";i.r(e);var n=i("7d24"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e["default"]=a.a}}]);