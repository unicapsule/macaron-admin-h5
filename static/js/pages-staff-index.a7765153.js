(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-staff-index"],{"09a1":function(t,a,e){a=t.exports=e("2350")(!1),a.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.add-wrap[data-v-559d3c2e]{text-align:right;margin:2.7vw 4vw}.staff-upload-avatar[data-v-559d3c2e]{margin:3vw 0}.add-staff[data-v-559d3c2e]{padding:2vw 4vw;border:1px solid #ddd;display:inline-block}.tab-list[data-v-559d3c2e]{border-bottom:1px solid #ddd}.tab-list-item[data-v-559d3c2e]{padding:1.3vw 2.7vw;position:relative}.data-list-item[data-v-559d3c2e]{padding:1.3vw 0}.select-wrap[data-v-559d3c2e]{margin:4vw}.select[data-v-559d3c2e]{display:inline-block;padding:.7vw 1.3vw;border:1px solid #ddd}.select-active[data-v-559d3c2e]{color:#fff;background-color:#4cd964}.country-input[data-v-559d3c2e]{width:18vw;border:1px solid #ddd}.staff-avatar[data-v-559d3c2e]{width:6.7vw;height:6.7vw;border-radius:50%;background-color:#ddd}.staff-desc[data-v-559d3c2e]{display:inline-block;max-width:20vw;word-break:break-all}.staff-action[data-v-559d3c2e]{min-width:20vw;display:-webkit-box;display:-webkit-flex;display:flex}',""])},"2a24":function(t,a,e){"use strict";var n=e("288e");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=n(e("cebc")),s=n(e("f499")),r=n(e("aab1")),o=n(e("44e1")),f=n(e("5e7f")),c=n(e("622e")),d={components:{pageHeader:r.default,uniDrawer:o.default,upload:f.default},data:function(){return{drawerVisible:!1,newStaffAvatar:"",staffInfo:{countryCode:"",username:"",email:"",phone:"",avatar:"",description:"",usernameErr:"",emailErr:"",phoneErr:"",descriptionErr:"",avatarErr:"",needPhoneVerify:!1,needEmailVerify:!1},tabList:[{name:"username",id:2},{name:"role",id:1},{name:"status",id:3},{name:"profile and desc",id:4},{name:"actions",id:5}],dataList:[],actions:{available:["Edit","Delete"],deleted:["Restore","Remove"]},roleValue:"staff",currentPage:1,pageSize:10,totalPage:1,countryCodes:[],countrys:[],initCountry:"",isEdit:!1}},computed:{shopId:function(){return uni.getStorageSync("shopId")},shopInfo:function(){return uni.getStorageSync("shopInfo")}},watch:{"staffInfo.username":function(){this.staffInfo.usernameErr=""},"staffInfo.email":function(){this.staffInfo.emailErr=""},"staffInfo.phone":function(){this.staffInfo.phoneErr=""},"staffInfo.description":function(){this.staffInfo.descriptionErr=""},"staffInfo.avatar":function(){this.staffInfo.avatarErr=""}},onLoad:function(){this.getAdminList(),this.getCountryCodes()},methods:{getCountryCodes:function(){var t=this;this.$getHttp(this.$API.getCountryCodes).then(function(a){t.countryCodes=a.data,t.staffInfo.countryCode=a.data[0].code,console.log(t.staffInfo),a.data.map(function(a){t.countrys.push(a.country)})})},getAdminList:function(){var t=this,a=this.currentPage,e=this.pageSize,n=this.shopId;this.$postHttp(this.$API.getAdminList,{restaurantId:n,page:a,size:e}).then(function(a){1==a.status?(t.dataList=a.data.list,t.totalPage=a.data.total):uni.showToast({icon:"none",title:"请求失败，请稍后再试"})})},validate:function(){this.regex;var t=this.staffInfo;return/^[0-9]/.test(t.username)?(this.staffInfo.usernameErr="Nickname cannot start with a number",!1):c.default.validateUserName(t.username)?c.default.validateEmail(t.email)?c.default.validatePhone(t.phone)?t.countryCode?t.avatar?!!t.description||(this.staffInfo.descriptionErr="description cannot be empty",!1):(this.staffInfo.avatarErr="avatar cannot be empty",!1):(uni.showToast({icon:"none",title:"countryCode cannot be empty"}),!1):(this.staffInfo.phoneErr="Please enter the correct phone",!1):(this.staffInfo.emailErr="Please enter the correct email address",!1):(this.staffInfo.usernameErr="Nickname may only contain A-Z, 0-9, spaces, _, -",!1)},confirmStaff:function(){if(this.validate()){var t=this.shopId,a=this.staffInfo,e=this.roleValue,n={countryCode:a.countryCode,phone:a.phone,email:a.email,username:a.username,role:e,restaurantId:t,description:a.description,avatar:a.avatar};this.isEdit?this.updateStaff(n):this.createStaff(n)}},createStaff:function(t){var a=this;this.$postHttp(this.$API.createStaff,t).then(function(t){1==t.status&&(uni.showToast({icon:"none",title:"successfully"}),a.getAdminList(),a.closeDrawer())})},updateStaff:function(t){var a=this,e=this.staffInfo;this.$postHttp(this.$API.updateAdmin,{info:(0,s.default)(t),adminId:e.id,dataType:"json"}).then(function(t){1==t.status?(uni.showToast({icon:"none",title:"successfully"}),a.closeDrawer(),a.getAdminList()):uni.showToast({icon:"none",title:"update faild, please try again"})})},deleteStaff:function(){var t=this,a=this.staffInfo;console.log(a),uni.showModal({title:"Alert",content:"Are you sure to delete ".concat(a.username,"?"),confirmText:"Yes",cancelText:"No",success:function(e){if(e.confirm){var n=(0,i.default)({},a,{status:"deleted"});t.updateStaff(n)}}})},closeDrawer:function(){this.$refs.drawer.forceClose(),this.staffInfo={countryCode:this.staffInfo.countryCode,username:"",email:"",phone:"",avatar:"",description:"",usernameErr:"",emailErr:"",phoneErr:"",descriptionErr:"",avatarErr:""},this.isEdit=!1,this.drawerVisible=!1},showDrawer:function(){this.drawerVisible=!0},uploadAvatar:function(t){this.staffInfo.avatar=t.url,console.log(t)},phoneVerifyChange:function(t){t.detail.value.length>0?this.staffInfo.needPhoneVerify=!0:this.staffInfo.needPhoneVerify=!1},emailVerifyChange:function(t){t.detail.value.length>0?this.staffInfo.needEmailVerify=!0:this.staffInfo.needEmailVerify=!1},changeSelect:function(t){var a=t.currentTarget.dataset.type;this.roleValue=a},changeCountry:function(t){this.staffInfo.countryCode=this.countryCodes[t.index].code},doAction:function(t){var a=this,e=t.currentTarget.dataset,n=e.action,s=(e.name,e.index);switch(this.staffInfo=(0,i.default)({},this.staffInfo,this.dataList[s]),n){case"Delete":this.deleteStaff();break;case"Edit":this.isEdit=!0,this.countryCodes.map(function(t){t.code==a.staffInfo.countryCode&&(a.initCountry=t.country)}),this.roleValue=this.staffInfo.role,this.showDrawer();break;case"Restore":this.updateStaff({status:"available",adminId:this.staffInfo.id});break;case"Remove":this.updateStaff({status:"banned",adminId:this.staffInfo.id});break}}}};a.default=d},"622e":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,e("6b54"),e("a481");var n={username:/^(?![0-9])[a-zA-Z0-9_-\s]+$/,phone:/^(\+1|1)?([2-9]\d\d[2-9]\d{6})$/,email:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,loginEmail:/^[A-Za-z0-9\u4e00-\u9fa5]+([\.-]?[A-Za-z0-9\u4e00-\u9fa5]+)*@\w+([\.]?\w+)*(\.\w{2,3})+$/};function i(t){return n.username.test(t)}function s(t){return n.email.test(t)}function r(t){return n.loginEmail.test(t)}function o(t){return n.phone.test(t)}function f(t){var a=t.length,e="";return t=t.toString().replace(/[^0-9]/g,""),a=a>0?a:10,11==a&&(e="1 ",t=t.substring(1)),area=t.substring(0,3),prefix=t.substring(3,6),line=t.substring(6),e+"("+area+") "+prefix+"-"+line}var c={validateEmail:s,validateLoginEmail:r,validatePhone:o,validateUserName:i,formatPhone:f};a.default=c},"6da0":function(t,a,e){"use strict";e.r(a);var n=e("2a24"),i=e.n(n);for(var s in n)"default"!==s&&function(t){e.d(a,t,function(){return n[t]})}(s);a["default"]=i.a},"7c00":function(t,a,e){"use strict";var n=e("ddda"),i=e.n(n);i.a},b57f:function(t,a,e){"use strict";e.r(a);var n=e("f51b"),i=e("6da0");for(var s in i)"default"!==s&&function(t){e.d(a,t,function(){return i[t]})}(s);e("7c00");var r,o=e("f0c5"),f=Object(o["a"])(i["default"],n["b"],n["c"],!1,null,"559d3c2e",null,!1,n["a"],r);a["default"]=f.exports},ddda:function(t,a,e){var n=e("09a1");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=e("4f06").default;i("6e4ea924",n,!0,{sourceMap:!1,shadowMode:!1})},f51b:function(t,a,e){"use strict";var n,i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("v-uni-view",{staticClass:"wrap"},[e("page-header"),e("v-uni-view",{staticClass:"add-wrap"},[e("v-uni-text",{staticClass:"add-staff",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.showDrawer.apply(void 0,arguments)}}},[t._v("add staff")])],1),e("v-uni-view",{staticClass:"staff-list"},[e("v-uni-view",{staticClass:"tab-list flex flex-between"},t._l(t.tabList,function(a,n){return e("v-uni-view",{key:n,staticClass:"tab-list-item"},[t._v(t._s(a.name))])}),1),e("v-uni-view",{staticClass:"data-list"},t._l(t.dataList,function(a,n){return e("v-uni-view",{key:n,staticClass:"data-list-item flex flex-between"},[e("v-uni-view",[e("v-uni-image",{staticClass:"avatar",attrs:{src:a.avatar}}),e("v-uni-text",[t._v(t._s(a.username))])],1),t._l(a.role,function(a,n){return e("v-uni-text",{key:n},[t._v(t._s(a))])}),e("v-uni-text",[t._v(t._s(a.status))]),e("v-uni-text",{staticClass:"staff-desc"},[t._v(t._s(a.email)+"/"+t._s(a.phone)+"/"+t._s(a.description))]),e("v-uni-view",{staticClass:"staff-action"},t._l(t.actions[a.status],function(i,s){return e("v-uni-view",{key:i},[e("v-uni-text",{staticClass:"btn",attrs:{"data-action":i,"data-index":n,"data-name":a.username},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.doAction.apply(void 0,arguments)}}},[t._v(t._s(i))])],1)}),1)],2)}),1)],1),e("uni-drawer",{ref:"drawer",attrs:{visible:t.drawerVisible,canClose:!1,mode:"right"}},[e("v-uni-view",{staticClass:"drawer-content"},[e("v-uni-view",[e("v-uni-view",[t._v("add new staff")]),e("v-uni-view",[e("v-uni-view",{staticClass:"input-wrap"},[e("v-uni-input",{staticClass:"input",attrs:{placeholder:"username",maxlength:"20"},model:{value:t.staffInfo.username,callback:function(a){t.$set(t.staffInfo,"username",a)},expression:"staffInfo.username"}})],1),e("v-uni-text",{staticClass:"error-text"},[t._v(t._s(t.staffInfo.usernameErr))])],1),e("v-uni-view",[e("v-uni-view",{staticClass:"flex align-center"},[e("v-uni-view",{staticClass:"input-wrap"},[e("v-uni-input",{staticClass:"input",attrs:{placeholder:"email"},model:{value:t.staffInfo.email,callback:function(a){t.$set(t.staffInfo,"email",a)},expression:"staffInfo.email"}})],1)],1),e("v-uni-text",{staticClass:"error-text"},[t._v(t._s(t.staffInfo.emailErr))])],1),e("v-uni-view",[e("v-uni-view",{staticClass:"flex align-center"},[t.drawerVisible?e("uni-select",{ref:"select",staticClass:"country-input",attrs:{list:t.countrys,clearable:!1,showItemNum:5,style_Container:"font-size: 16px;",initValue:t.initCountry||t.countrys[0],selectHideType:"hideAll"},on:{change:function(a){arguments[0]=a=t.$handleEvent(a),t.changeCountry.apply(void 0,arguments)}}}):t._e(),e("v-uni-view",{staticClass:"input-wrap"},[e("v-uni-input",{staticClass:"input",attrs:{placeholder:"phone"},model:{value:t.staffInfo.phone,callback:function(a){t.$set(t.staffInfo,"phone",a)},expression:"staffInfo.phone"}})],1)],1),e("v-uni-text",{staticClass:"error-text"},[t._v(t._s(t.staffInfo.phoneErr))])],1)],1),e("upload",{staticClass:"staff-upload-avatar",on:{uploadOk:function(a){arguments[0]=a=t.$handleEvent(a),t.uploadAvatar.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"flex align-center"},[t.staffInfo.avatar?e("v-uni-image",{staticClass:"staff-avatar",attrs:{src:t.staffInfo.avatar}}):e("v-uni-view",{staticClass:"staff-avatar"}),e("v-uni-text",[t._v("upload avatar")]),e("v-uni-text",{staticClass:"error-text"},[t._v(t._s(t.staffInfo.avatarErr))])],1)],1),e("v-uni-textarea",{staticClass:"textarea",attrs:{placeholder:"description"},model:{value:t.staffInfo.description,callback:function(a){t.$set(t.staffInfo,"description",a)},expression:"staffInfo.description"}}),e("v-uni-text",{staticClass:"error-text"},[t._v(t._s(t.staffInfo.descriptionErr))]),e("v-uni-view",{staticClass:"select-wrap"},[e("v-uni-text",{staticClass:"select",class:"admin"==t.roleValue?"select-active":"",attrs:{"data-type":"admin"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.changeSelect.apply(void 0,arguments)}}},[t._v("admin")]),e("v-uni-text",{staticClass:"select",class:"staff"==t.roleValue?"select-active":"",attrs:{"data-type":"staff"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.changeSelect.apply(void 0,arguments)}}},[t._v("staff")])],1),e("v-uni-view",{staticClass:"text-right"},[e("v-uni-text",{staticClass:"btn",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.closeDrawer.apply(void 0,arguments)}}},[t._v("cancel")]),e("v-uni-text",{staticClass:"btn btn-primary",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.confirmStaff.apply(void 0,arguments)}}},[t._v("confirm")])],1)],1)],1)],1)},s=[];e.d(a,"b",function(){return i}),e.d(a,"c",function(){return s}),e.d(a,"a",function(){return n})}}]);