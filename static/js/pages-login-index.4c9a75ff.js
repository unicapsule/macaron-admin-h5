(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-login-index"],{"1ed9":function(t,i,n){var s=n("6bda");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var e=n("4f06").default;e("5520d406",s,!0,{sourceMap:!1,shadowMode:!1})},"25a7":function(t,i,n){"use strict";n.r(i);var s=n("2684"),e=n("dda9");for(var o in e)"default"!==o&&function(t){n.d(i,t,function(){return e[t]})}(o);n("b36f");var a,h=n("f0c5"),p=Object(h["a"])(e["default"],s["b"],s["c"],!1,null,"1b008616",null,!1,s["a"],a);i["default"]=p.exports},2684:function(t,i,n){"use strict";var s,e=function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("v-uni-view",{staticClass:"login wrap"},[n("v-uni-view",{staticClass:"flex flex-between"},[t.logo?n("v-uni-image",{staticClass:"logo",attrs:{src:t.logo}}):t._e(),n("v-uni-text",[t._v(t._s(t.shopName))])],1),n("v-uni-view",{staticClass:"login-area"},[n("v-uni-view",[t._v(t._s(t.loginStatus)+" login")]),"email"==t.loginStatus?n("v-uni-view",{staticClass:"input-area"},[n("v-uni-view",{staticClass:"input-wrap"},[n("v-uni-input",{staticClass:"input",attrs:{placeholder:"enter your email here"},model:{value:t.email,callback:function(i){t.email=i},expression:"email"}})],1),n("v-uni-view",{staticClass:"input-wrap"},[n("v-uni-input",{staticClass:"input",attrs:{placeholder:"password"},model:{value:t.emailPsw,callback:function(i){t.emailPsw=i},expression:"emailPsw"}})],1)],1):t._e(),"phone"==t.loginStatus?n("v-uni-view",{staticClass:"input-area"},[n("v-uni-view",{staticClass:"input-wrap"},[n("v-uni-input",{staticClass:"input",attrs:{placeholder:"enter your phone here"},model:{value:t.phone,callback:function(i){t.phone=i},expression:"phone"}})],1),n("v-uni-view",{staticClass:"input-wrap"},[n("v-uni-input",{staticClass:"input",attrs:{placeholder:"password"},model:{value:t.phonePsw,callback:function(i){t.phonePsw=i},expression:"phonePsw"}})],1)],1):t._e()],1),n("v-uni-view",{staticClass:"login-btn",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.login.apply(void 0,arguments)}}},[t._v("login")]),n("uni-notify",{ref:"notify"})],1)},o=[];n.d(i,"b",function(){return e}),n.d(i,"c",function(){return o}),n.d(i,"a",function(){return s})},"622e":function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0,n("6b54"),n("a481");var s={username:/^(?![0-9])[a-zA-Z0-9_-\s]+$/,phone:/^(\+1|1)?([2-9]\d\d[2-9]\d{6})$/,email:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,loginEmail:/^[A-Za-z0-9\u4e00-\u9fa5]+([\.-]?[A-Za-z0-9\u4e00-\u9fa5]+)*@\w+([\.]?\w+)*(\.\w{2,3})+$/};function e(t){return s.username.test(t)}function o(t){return s.email.test(t)}function a(t){return s.loginEmail.test(t)}function h(t){return s.phone.test(t)}function p(t){var i=t.length,n="";return t=t.toString().replace(/[^0-9]/g,""),i=i>0?i:10,11==i&&(n="1 ",t=t.substring(1)),area=t.substring(0,3),prefix=t.substring(3,6),line=t.substring(6),n+"("+area+") "+prefix+"-"+line}var r={validateEmail:o,validateLoginEmail:a,validatePhone:h,validateUserName:e,formatPhone:p};i.default=r},"6bda":function(t,i,n){i=t.exports=n("2350")(!1),i.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.status-area[data-v-1b008616]{margin-top:4vw;margin-right:2vw;width:20vw;padding:2vw 0;text-align:center;border:1px solid #ddd}.status-area.active[data-v-1b008616]{color:#fff;background-color:#4cd964;border-color:#fff}.login-area[data-v-1b008616]{border:1px solid #ddd;padding:2.7vw 6.7vw;margin-top:2vw}.login-btn[data-v-1b008616]{text-align:center;padding:2.7vw 4vw;background-color:#4cd964;border:1px solid #ddd;border-radius:1.3vw;color:#fff;margin:2.7vw 0}',""])},b36f:function(t,i,n){"use strict";var s=n("1ed9"),e=n.n(s);e.a},c733:function(t,i,n){"use strict";var s=n("288e");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e=s(n("622e")),o=(n("2f62"),{data:function(){return{loginStatus:"email",email:"",emailPsw:"",phone:"",phonePsw:"",beforePage:"",shopId:"",shopName:"",logo:"",initCompany:"",initShop:"",initCompanyId:"",initShopId:"",companyList:[],shopList:[],companyNameList:[],shopNameList:[]}},onLoad:function(t){this.beforePage=t.beforePage||"",uni.removeStorageSync("token"),this.initLogin(t),this.initShopInfo()},onBackPress:function(t){return"navigateBack"!==t.from&&(t.from,!0)},methods:{initLogin:function(t){this.shopId=t.shopId||"kx~shop~macaron",this.shopId&&this.getShopInfo(this.shopId)},initShopInfo:function(){this.shopName=uni.getStorageSync("shopName")||"",this.logo=uni.getStorageSync("logo")||""},changeStatus:function(t){var i=t.currentTarget.dataset.status;this.loginStatus=i},getAllCompany:function(){var t=this;this.$getHttp(this.$API.getAllCompany,{type:"restaurant"}).then(function(i){if(1==i.status){var n=[];t.companyList=i.data,i.data.map(function(t){n.push(t.name)}),t.companyNameList=n,t.initCompanyList()}})},initCompanyList:function(){var t=this,i=uni.getStorageSync("cacheCompany"),n=uni.getStorageSync("cacheShop"),s=[];i?(this.initCompany=i.name,this.initCompanyId=i.id,this.initShop=n.name,this.initShopId=n.id,this.shopId=this.initShopId,this.companyList.map(function(n){n.companyId==i.id&&(t.shopList=n.shopList,n.shopList.map(function(t){s.push(t.shopName)}),t.shopNameList=s,console.log(s))})):(this.initCompany=this.companyNameList[0],this.initCompanyId=this.companyNameList[0].companyId,this.initShop=this.companyList[0].shopList[0]&&this.companyList[0].shopList[0].shopName,this.initShopId=this.companyList[0].shopList[0]&&this.companyList[0].shopList[0].shopId,this.shopId=this.initShopId,this.shopList=this.companyList[0],this.companyList[0].shopList.map(function(t){s.push(t.shopName)}),this.shopNameList=s)},selectCompany:function(t){var i=[];this.shopNameList=[],this.shopList=this.companyList[t.index].shopList,this.companyList[t.index].shopList.map(function(t){i.push(t.shopName)}),this.initCompany=this.companyNameList[t.index],this.initCompanyId=this.companyList[t.index].companyId,this.shopNameList=i,1==i.length?(this.initShop=i[0],this.initShopId=this.companyList[t.index].shopList[0].shopId,this.shopId=this.companyList[t.index].shopList[0].shopId):(this.initShop="",this.initShopId="",this.$refs.shopSelect.init(),this.shopId="")},selectShop:function(t){this.shopId=this.shopList[t.index].shopId,this.initShop=this.shopNameList[t.index],this.initShopId=this.shopList[t.index].shopId},getShopInfo:function(t){var i=this;this.$getHttp(this.$API.getShopInfo+"/".concat(t)).then(function(t){1==t.status&&(uni.setStorageSync("shopName",t.data.name),uni.setStorageSync("logo",t.data.logo),uni.setStorageSync("shopId",t.data.restaurantId),i.shopName=t.data.name||"",i.logo=t.data.logo||"")})},validateLogin:function(){var t=this.loginStatus,i=this.email,n=this.phone,s=this.emailPsw,o=this.phonePsw;return"email"!=t||e.default.validateLoginEmail(i)?"phone"!=t||e.default.validatePhone(n)?!("email"==t&&!s||"phone"==t&&!o)||(uni.showToast({icon:"none",title:"Please enter the password"}),!1):(uni.showToast({icon:"none",title:"Please enter the correct phone"}),!1):(uni.showToast({icon:"none",title:"Please enter the correct email"}),!1)},login:function(){var t=this,i=this.email,n=this.emailPsw,s=(this.phone,this.phonePsw,this.loginStatus),e=this.beforePage,o=this.shopId,a="",h={};this.validateLogin()&&("email"==s&&(a=this.$API.loginShop,h={email:i,password:n,shopId:o}),this.$postHttp(a,h).then(function(i){if(1==i.status){var n=i.data;"available"!=n.status?uni.showToast({icon:"none",title:"您的账号暂不可登录"}):(uni.showToast({icon:"none",title:"登录成功"}),uni.setStorageSync("token",n.token),uni.setStorageSync("shopInfo",n),e&&"undefined"!=e?uni.redirectTo({url:"/"+e}):uni.redirectTo({url:"/pages/index/index"}))}else t.$notify({type:"warning",title:i.message||"login failed",button:[],callback:function(){console.log("login error")}})}))},setCache:function(){uni.setStorageSync("cacheShop",{name:this.initShop,id:this.initShopId}),uni.setStorageSync("cacheCompany",{name:this.initCompany,id:this.initCompanyId})}}});i.default=o},dda9:function(t,i,n){"use strict";n.r(i);var s=n("c733"),e=n.n(s);for(var o in s)"default"!==o&&function(t){n.d(i,t,function(){return s[t]})}(o);i["default"]=e.a}}]);